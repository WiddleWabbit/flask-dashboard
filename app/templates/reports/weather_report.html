<div class="report" id="report-{{ report.id }}" style="width:100%; height:500px;">
    <h3>Weather Report</h3>
    <canvas id="chart-{{ report.id }}"></canvas>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const weatherData = {{ weather_data | tojson }};
        const ctx = document.getElementById('chart-{{ report.id }}').getContext('2d');
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: weatherData.map(d => d.time),
                datasets: [
                    {
                        label: 'Avg Temp (°C)',
                        data: weatherData.map(d => d.temp),
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: '#ffeded',
                        pointRadius: 4,
                        yAxisID: 'temp',
                        fill: false
                    },
                    // {
                    //     label: 'Clouds (%)',
                    //     data: weatherData.map(d => d.clouds),
                    //     borderColor: 'rgba(75, 192, 192, 1)',
                    //     yAxisID: 'percentage',
                    //     fill: false
                    // },
                    {
                        label: 'Rainfall (mm)',
                        data: weatherData.map(d => d.rainfall),
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: '#edf3ff',
                        pointRadius: 4,
                        yAxisID: 'rainfall',
                        fill: true
                    }
                ]
                // datasets: [
                //     {
                //         label: 'Avg Temp (°C)',
                //         data: weatherData.map(d => d.temp),
                //         borderColor: 'rgba(255, 99, 132, 1)',
                //         pointRadius: 4,
                //         yAxisID: 'temp',
                //         fill: false
                //     },
                //     {
                //         label: 'Humidity (%)',
                //         data: weatherData.map(d => d.humidity),
                //         borderColor: 'rgba(153, 102, 255, 1)',
                //         yAxisID: 'percentage',
                //         fill: false
                //     },
                //     {
                //         label: 'Clouds (%)',
                //         data: weatherData.map(d => d.clouds),
                //         borderColor: 'rgba(75, 192, 192, 1)',
                //         yAxisID: 'percentage',
                //         fill: false
                //     },
                //     {
                //         label: 'Rainfall (mm)',
                //         data: weatherData.map(d => d.rainfall),
                //         borderColor: 'rgba(54, 162, 235, 1)',
                //         backgroundColor: '#edf3ff',
                //         yAxisID: 'rainfall',
                //         fill: true
                //     }
                // ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: { display: true, text: 'Date' }
                    },
                    temp: {
                        type: 'linear',
                        position: 'left',
                        title: { display: true, text: 'Temperature (°C)' },
                        min: 0,
                        max: 50
                    },
                    // percentage: {
                    //     type: 'linear',
                    //     position: 'right',
                    //     title: { display: true, text: 'Percentage (%)' },
                    //     max: 100,
                    //     min: 0
                    // },
                    rainfall: {
                        type: 'linear',
                        position: 'right',
                        title: { display: true, text: 'Rainfall (mm)' },
                        grid: { drawOnChartArea: false } // Avoid overlapping grid lines
                    }
                }
            }
        });
    });
</script>